<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reserva de Casillero - GestiFit</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Teko:wght@300..700&display=swap" rel="stylesheet">

        <!-- Icon Font Stylesheet -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="icon" type="image/png" href="/GestiFit/public/img/logo_gestifit_cuadrado-nofondo.png">

        <!-- Libraries Stylesheet -->
        <link rel="stylesheet" href="/GestiFit/lib/animate/animate.min.css"/>
        <link href="/GestiFit/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">


        <!-- Customized Bootstrap Stylesheet -->
        <link href="/GestiFit/public/css/bootstrap.min.css" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="/GestiFit/public/css/style.css" rel="stylesheet">
        <link href="/GestiFit/public/css/stylesUsuario.css" rel="stylesheet">
    
  <style>
    :root {
      --bs-primary: #ff214f;
      --bs-dark: #000000;
      --bs-white: #ffffff;
      --bs-light: #f8f9fa;
      --bs-gray: #6c757d;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bs-light);
      color: var(--bs-dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
      flex-grow: 1;
    }
    
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 40px;
      color: var(--bs-dark);
      position: relative;
      display: inline-block;
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 0;
      width: 80px;
      height: 4px;
      background: var(--bs-primary);
    }
    
    #casilleros {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .casillero-btn {
      padding: 20px;
      border-radius: 10px;
      border: none;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      text-align: center;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      transform: skew(-5deg);
    }
    
    .casillero-btn.disponible {
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      color: var(--bs-white);
      box-shadow: 0 5px 15px rgba(46, 125, 50, 0.3);
    }
    
    .casillero-btn.reservado {
      background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
      color: var(--bs-white);
      box-shadow: 0 5px 15px rgba(198, 40, 40, 0.2);
      cursor: not-allowed;
    }
    
    .casillero-btn.seleccionado {
      transform: skew(-5deg) translateY(-10px);
      box-shadow: 0 15px 30px rgba(12, 24, 68, 0.3);
      outline: 3px solid var(--bs-primary);
      outline-offset: 3px;
    }
    
    .casillero-btn .badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--bs-white);
      color: var(--bs-dark);
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 700;
    }
    
    #reservarBtn {
      background: var(--bs-primary);
      color: var(--bs-white);
      border: none;
      padding: 12px 30px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
      transform: skew(-18deg);
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(255, 33, 79, 0.4);
    }
    
    #reservarBtn span {
      display: inline-block;
      transform: skew(18deg);
    }
    
    #reservarBtn:hover {
      background: var(--bs-dark);
      transform: skew(-18deg) translateY(-3px);
      box-shadow: 0 8px 20px rgba(12, 24, 68, 0.3);
    }
    
    #reservarBtn:disabled {
      background: var(--bs-gray);
      transform: skew(-18deg);
      cursor: not-allowed;
      box-shadow: none;
    }
    
    .alert {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      background: var(--bs-primary);
      color: var(--bs-white);
      border-radius: 5px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      z-index: 1000;
      transform: translateX(150%);
      transition: transform 0.4s ease;
    }
    
    .alert.show {
      transform: translateX(0);
    }
    
    @media (max-width: 768px) {
      #casilleros {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
      
      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Reserva tu Casillero</h1>

    <div id="casilleros" class="grid-container"></div>

    <div class="text-center mt-8">
      <button id="reservarBtn" disabled>
        <span>Reservar Casillero</span>
      </button>
    </div>
  </div>

  <div id="alert" class="alert" style="display: none;"></div>

  <script>
    let seleccionado = null;
    const casilleroDiv = document.getElementById("casilleros");
    const reservarBtn = document.getElementById("reservarBtn");
    const alertDiv = document.getElementById("alert");

    function showAlert(message, isSuccess = true) {
      alertDiv.textContent = message;
      alertDiv.style.backgroundColor = isSuccess ? 'var(--bs-primary)' : '#c62828';
      alertDiv.style.display = 'block';
      alertDiv.classList.add('show');
      
      setTimeout(() => {
        alertDiv.classList.remove('show');
        setTimeout(() => {
          alertDiv.style.display = 'none';
        }, 400);
      }, 3000);
    }

    fetch("/GestiFit/src/usuarioPHP/casillero/Casillero.php?action=listar")
      .then(res => res.json())
      .then(data => {
        if(data.error) {
          showAlert("Error al cargar casilleros: " + data.message, false);
          return;
        }
        
        data.forEach(c => {
          const btn = document.createElement("button");
          btn.className = `casillero-btn ${c.estado === "reservado" ? "reservado" : "disponible"}`;
          btn.disabled = c.estado === "reservado";
          
          btn.innerHTML = `
            <span>Casillero ${c.numero}</span>
            <span class="badge">${c.estado === "reservado" ? "Ocupado" : "Disponible"}</span>
          `;
          
          btn.addEventListener("click", () => {
            if(c.estado === "reservado") return;
            
            document.querySelectorAll(".casillero-btn").forEach(b => {
              b.classList.remove("seleccionado");
            });
            
            btn.classList.add("seleccionado");
            seleccionado = c.id_casillero;
            reservarBtn.disabled = false;
          });
          
          casilleroDiv.appendChild(btn);
        });
      })
      .catch(error => {
        showAlert("Error de conexión: " + error.message, false);
      });

    reservarBtn.addEventListener("click", () => {
      if (!seleccionado) return;
      
      reservarBtn.disabled = true;
      reservarBtn.innerHTML = '<span><i class="fas fa-spinner fa-spin"></i> Procesando...</span>';
      
      fetch("Casillero.php?action=reservar", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: "id=" + seleccionado
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          showAlert("¡Casillero reservado con éxito!");
          setTimeout(() => {
            location.reload();
          }, 1500);
        } else {
          showAlert("Error al reservar: " + data.message, false);
          reservarBtn.disabled = false;
          reservarBtn.innerHTML = '<span>Reservar Casillero</span>';
        }
      })
      .catch(error => {
        showAlert("Error de conexión: " + error.message, false);
        reservarBtn.disabled = false;
        reservarBtn.innerHTML = '<span>Reservar Casillero</span>';
      });
    });
  </script>
</body>
</html>